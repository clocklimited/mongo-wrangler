#!/usr/bin/env node
!function(e){var n={};function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)o.d(t,r,function(n){return e[n]}.bind(null,r));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="",o(o.s=1)}([function(e,n){e.exports=require("path")},function(e,n,o){e.exports=o(2)},function(e,n,o){var t=o(3).execSync,r=o(4).existsSync,s=o(5)(process.argv.slice(2),{boolean:["v","n"]}),i=o(6),l=o(0),c=s._[0]||process.env.DATABASE_NAME,a=process.env.URL||s._[1],u=!!s.v,f=!!s.n,p="/tmp/"+Math.random().toString(36).substr(2)+"/";function d(e){let n;u&&console.log("$ "+i(e,"dark grey"));try{n=t(e).toString()}catch(e){console.error("There was an error. Use `-v` to see the failed output. Often -n to ignore indexes, fixes the issue."),process.exit(1)}return u&&console.log(n),n}c||(console.error(i("Missing database name","red")),console.log(""),console.log("Usage:"),console.log("\t"+l.basename(process.argv[1])+" [options] database url"),console.log("Options:"),console.log("\t-v - verbose"),console.log("\t-n - no indexes"),console.log("\n"),process.exit(1));var g=o(7).parse,b=(0,o(0).basename)(g(a).path).replace(/\.tar\.zst$/g,"");console.log("Restoring Database",i(c,"yellow"),"from",i(a,"green")),d("mkdir -p "+p),d("curl --silent "+a+" | unzstd | tar -xf - -C "+p),d("mongorestore "+(u?"":"--quiet ")+(f?"--noIndexRestore":"")+" --drop -d "+c+" "+p+"dump/"+b),!f&&r(p+"indexes")&&(console.log("Restoring Indexes"),d("mongo "+c+" "+p+"indexes")),console.log("Clearing up"),d("rm -rf "+p)},function(e,n){e.exports=require("child_process")},function(e,n){e.exports=require("fs")},function(e,n){function o(e){return"number"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e))}e.exports=function(e,n){n||(n={});var t={bools:{},strings:{},unknownFn:null};"function"==typeof n.unknown&&(t.unknownFn=n.unknown),"boolean"==typeof n.boolean&&n.boolean?t.allBools=!0:[].concat(n.boolean).filter(Boolean).forEach(function(e){t.bools[e]=!0});var r={};Object.keys(n.alias||{}).forEach(function(e){r[e]=[].concat(n.alias[e]),r[e].forEach(function(n){r[n]=[e].concat(r[e].filter(function(e){return n!==e}))})}),[].concat(n.string).filter(Boolean).forEach(function(e){t.strings[e]=!0,r[e]&&(t.strings[r[e]]=!0)});var s=n.default||{},i={_:[]};Object.keys(t.bools).forEach(function(e){c(e,void 0!==s[e]&&s[e])});var l=[];function c(e,n,s){if(!s||!t.unknownFn||function(e,n){return t.allBools&&/^--[^=]+$/.test(n)||t.strings[e]||t.bools[e]||r[e]}(e,s)||!1!==t.unknownFn(s)){var l=!t.strings[e]&&o(n)?Number(n):n;a(i,e.split("."),l),(r[e]||[]).forEach(function(e){a(i,e.split("."),l)})}}function a(e,n,o){var r=e;n.slice(0,-1).forEach(function(e){void 0===r[e]&&(r[e]={}),r=r[e]});var s=n[n.length-1];void 0===r[s]||t.bools[s]||"boolean"==typeof r[s]?r[s]=o:Array.isArray(r[s])?r[s].push(o):r[s]=[r[s],o]}function u(e){return r[e].some(function(e){return t.bools[e]})}-1!==e.indexOf("--")&&(l=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var f=0;f<e.length;f++){var p=e[f];if(/^--.+=/.test(p)){var d=p.match(/^--([^=]+)=([\s\S]*)$/),g=d[1],b=d[2];t.bools[g]&&(b="false"!==b),c(g,b,p)}else if(/^--no-.+/.test(p)){c(g=p.match(/^--no-(.+)/)[1],!1,p)}else if(/^--.+/.test(p)){g=p.match(/^--(.+)/)[1];void 0===(y=e[f+1])||/^-/.test(y)||t.bools[g]||t.allBools||r[g]&&u(g)?/^(true|false)$/.test(y)?(c(g,"true"===y,p),f++):c(g,!t.strings[g]||"",p):(c(g,y,p),f++)}else if(/^-[^-]+/.test(p)){for(var v=p.slice(1,-1).split(""),h=!1,m=0;m<v.length;m++){var y;if("-"!==(y=p.slice(m+2))){if(/[A-Za-z]/.test(v[m])&&/=/.test(y)){c(v[m],y.split("=")[1],p),h=!0;break}if(/[A-Za-z]/.test(v[m])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(y)){c(v[m],y,p),h=!0;break}if(v[m+1]&&v[m+1].match(/\W/)){c(v[m],p.slice(m+2),p),h=!0;break}c(v[m],!t.strings[v[m]]||"",p)}else c(v[m],y,p)}g=p.slice(-1)[0];h||"-"===g||(!e[f+1]||/^(-|--)[^-]/.test(e[f+1])||t.bools[g]||r[g]&&u(g)?e[f+1]&&/true|false/.test(e[f+1])?(c(g,"true"===e[f+1],p),f++):c(g,!t.strings[g]||"",p):(c(g,e[f+1],p),f++))}else if(t.unknownFn&&!1===t.unknownFn(p)||i._.push(t.strings._||!o(p)?p:Number(p)),n.stopEarly){i._.push.apply(i._,e.slice(f+1));break}}return Object.keys(s).forEach(function(e){(function(e,n){var o=e;return n.slice(0,-1).forEach(function(e){o=o[e]||{}}),n[n.length-1]in o})(i,e.split("."))||(a(i,e.split("."),s[e]),(r[e]||[]).forEach(function(n){a(i,n.split("."),s[e])}))}),n["--"]?(i["--"]=new Array,l.forEach(function(e){i["--"].push(e)})):l.forEach(function(e){i._.push(e)}),i}},function(e,n){var o={reset:"[0m",red:"[31m",green:"[32m",grey:"[38;5;245m","dark grey":"[38;5;245m",yellow:"[33;1m",white:"[37;1m"};e.exports=function(e,n){return(o[n]||o.reset)+e+o.reset}},function(e,n){e.exports=require("url")}]);